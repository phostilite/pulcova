{% extends "../base.html" %}
{% load static %}

{% block title %}{{ solution.title }} - Solutions | Pulcova{% endblock %}
{% block meta_description %}{{ solution.meta_description|default:solution.problem_description|truncatewords:25 }}{% endblock %}

{% block og_title %}{{ solution.title }} - Solutions | Pulcova{% endblock %}
{% block og_description %}{{ solution.meta_description|default:solution.problem_description|truncatewords:25 }}{% endblock %}
{% block og_image %}{% if solution.og_image and solution.og_image.url %}{{ request.scheme }}://{{ request.get_host }}{{ solution.og_image.url }}{% else %}{% static 'images/og-default.jpg' %}{% endif %}{% endblock %}

{% block extra_css %}
<style>
/* Solution content styling */
.solution-content {
    font-size: 1.125rem;
    line-height: 1.75;
}

.solution-content h1,
.solution-content h2,
.solution-content h3,
.solution-content h4,
.solution-content h5,
.solution-content h6 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: 600;
    color: rgb(31 41 55);
}

.dark .solution-content h1,
.dark .solution-content h2,
.dark .solution-content h3,
.dark .solution-content h4,
.dark .solution-content h5,
.dark .solution-content h6 {
    color: rgb(249 250 251);
}

.solution-content p {
    margin-bottom: 1.5rem;
}

.solution-content pre {
    background-color: rgb(31 41 55);
    color: rgb(209 213 219);
    padding: 1.5rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
    font-size: 0.875rem;
    line-height: 1.5;
}

.solution-content code {
    background-color: rgb(243 244 246);
    color: rgb(220 38 127);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
}

.dark .solution-content code {
    background-color: rgb(55 65 81);
    color: rgb(251 113 133);
}

.solution-content blockquote {
    border-left: 4px solid rgb(59 130 246);
    padding-left: 1.5rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: rgb(75 85 99);
}

.dark .solution-content blockquote {
    color: rgb(156 163 175);
}

.solution-content ul,
.solution-content ol {
    margin: 1.5rem 0;
    padding-left: 2rem;
}

.solution-content li {
    margin-bottom: 0.5rem;
}

/* Difficulty badge styling */
.difficulty-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Code block styling */
.code-block {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    border: 1px solid #475569;
    border-radius: 0.75rem;
    overflow: hidden;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

.code-header {
    background: linear-gradient(90deg, #374151 0%, #4b5563 100%);
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #6b7280;
    display: flex;
    align-items: center;
    justify-content: between;
}

.code-content {
    padding: 1.5rem;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.875rem;
    line-height: 1.6;
    color: #e5e7eb;
    overflow-x: auto;
}
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb Navigation -->
<section class="bg-gray-50 dark:bg-gray-800 py-8">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <nav class="flex" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                {% for breadcrumb in breadcrumbs %}
                <li class="inline-flex items-center">
                    {% if not breadcrumb.current %}
                        <a href="{{ breadcrumb.url }}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-primary-600 dark:text-gray-400 dark:hover:text-white">
                            {% if forloop.first %}
                                <svg class="w-3 h-3 mr-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L9 3.414V19a1 1 0 0 0 2 0V3.414l7.293 7.293a1 1 0 0 0 1.414-1.414Z"/>
                                </svg>
                            {% endif %}
                            {{ breadcrumb.title }}
                        </a>
                    {% else %}
                        <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400">{{ breadcrumb.title }}</span>
                    {% endif %}
                    {% if not forloop.last %}
                        <svg class="w-3 h-3 text-gray-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                        </svg>
                    {% endif %}
                </li>
                {% endfor %}
            </ol>
        </nav>
    </div>
</section>

<!-- Back to Solutions Button -->
<div class="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <a href="/solutions/" class="inline-flex items-center text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium text-sm">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Back to Solutions
        </a>
    </div>
</div>

<!-- Solution Content -->
<article class="bg-white dark:bg-gray-900 py-16">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto">
            <!-- Solution Header -->
            <header class="mb-12">
                <!-- Meta Information -->
                <div class="flex flex-wrap items-center gap-4 mb-6">
                    {% if has_technology %}
                    <div class="flex items-center space-x-2">
                        {% if technology_info.icon %}
                        <img src="{{ technology_info.icon.url }}" alt="{{ technology_info.name }}" class="w-6 h-6 rounded">
                        {% endif %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200">
                            {{ technology_info.name }}
                        </span>
                    </div>
                    {% endif %}
                    
                    <!-- Difficulty Level -->
                    <span class="difficulty-badge {{ difficulty_class }}">
                        {{ difficulty_display }}
                    </span>
                </div>

                <!-- Solution Title -->
                <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white leading-tight mb-6">
                    {{ solution.title }}
                </h1>

                <!-- Solution Meta Information -->
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 py-6 border-t border-b border-gray-200 dark:border-gray-700">
                    <!-- Stats -->
                    <div class="flex items-center space-x-6">
                        <div class="flex items-center space-x-2">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                            <span class="text-sm text-gray-600 dark:text-gray-400">{{ view_count }} views</span>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V8a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                            </svg>
                            <span class="text-sm text-gray-600 dark:text-gray-400">{{ helpful_count }} helpful</span>
                        </div>

                        <div class="flex items-center space-x-2">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <span class="text-sm text-gray-600 dark:text-gray-400">{{ solution.created_at|date:"M d, Y" }}</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center space-x-4">
                        <button onclick="toggleHelpful()" class="inline-flex items-center px-4 py-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-medium transition-all">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V8a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                            </svg>
                            Helpful
                        </button>
                        
                        <button onclick="shareContent()" class="inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-all">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                            </svg>
                            Share
                        </button>
                    </div>
                </div>
            </header>

            <!-- Problem Description -->
            <section class="mb-12">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                    Problem Description
                </h2>
                <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6">
                    <div class="solution-content">
                        {{ solution.problem_description|linebreaks }}
                    </div>
                </div>
            </section>

            <!-- Root Cause -->
            <section class="mb-12">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                    Root Cause Analysis
                </h2>
                <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6">
                    <div class="solution-content">
                        {{ solution.root_cause|linebreaks }}
                    </div>
                </div>
            </section>

            <!-- Solution Content -->
            <section class="mb-12">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                    Solution
                </h2>
                <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6">
                    <div class="solution-content">
                        {{ solution.solution_content|safe }}
                    </div>
                </div>
            </section>

            <!-- Code Snippets Section -->
            {% if has_code_snippets %}
            <section class="mb-12">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                    Related Code Snippets
                </h2>
                <div class="grid gap-6">
                    {% for snippet in code_snippets %}
                    <div class="code-block">
                        <div class="code-header">
                            <div class="flex items-center justify-between w-full">
                                <div>
                                    <h3 class="font-medium text-white">{{ snippet.title }}</h3>
                                    <p class="text-sm text-gray-300">{{ snippet.language|capfirst }}</p>
                                </div>
                                <button onclick="copyCode('code-{{ forloop.counter }}')" class="px-3 py-1 bg-gray-600 hover:bg-gray-500 text-white text-sm rounded transition-colors">
                                    Copy
                                </button>
                            </div>
                        </div>
                        <div class="code-content">
                            <pre id="code-{{ forloop.counter }}"><code>{{ snippet.code }}</code></pre>
                        </div>
                        {% if snippet.description %}
                        <div class="px-6 pb-6">
                            <p class="text-sm text-gray-300">{{ snippet.description }}</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>
    </div>
</article>

<!-- Related Solutions Section -->
{% if has_related_solutions %}
<section class="bg-gray-50 dark:bg-gray-800 py-16">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-8 text-center">
                Related Solutions
            </h2>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for related_solution in related_solutions %}
                <article class="bg-white dark:bg-gray-900 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300 group">
                    <div class="p-6">
                        <!-- Meta info -->
                        <div class="flex items-center justify-between mb-4">
                            <span class="difficulty-badge {{ related_solution.difficulty_level|default:'beginner'|add:'-class' }}">
                                {{ related_solution.get_difficulty_level_display }}
                            </span>
                            {% if related_solution.technology %}
                            <span class="text-xs text-gray-500 dark:text-gray-400">
                                {{ related_solution.technology.name }}
                            </span>
                            {% endif %}
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
                            {{ related_solution.title }}
                        </h3>
                        
                        <p class="text-gray-600 dark:text-gray-400 mb-4 line-clamp-3">
                            {{ related_solution.problem_description|truncatewords:20 }}
                        </p>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                                <span>👁 {{ related_solution.view_count }}</span>
                                <span>👍 {{ related_solution.helpful_count }}</span>
                            </div>
                            <a href="{{ related_solution.get_absolute_url }}" class="inline-flex items-center text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium">
                                View Solution
                                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </article>
                {% endfor %}
            </div>
            
            <div class="text-center mt-12">
                <a href="/solutions/" class="inline-flex items-center justify-center px-6 py-3 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-900 dark:text-white font-medium rounded-lg border border-gray-300 dark:border-gray-700 transition-all">
                    View All Solutions
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Schema.org Structured Data -->
{% if structured_data %}
<script type="application/ld+json">
{{ structured_data|safe }}
</script>
{% endif %}

<script>
// Copy code functionality
function copyCode(elementId) {
    const codeElement = document.getElementById(elementId);
    const textToCopy = codeElement.textContent;
    
    navigator.clipboard.writeText(textToCopy).then(function() {
        // Show feedback
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.add('bg-green-600');
        button.classList.remove('bg-gray-600');
        
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-green-600');
            button.classList.add('bg-gray-600');
        }, 2000);
    }).catch(function(err) {
        console.error('Failed to copy: ', err);
    });
}

// Share functionality
function shareContent() {
    if (navigator.share) {
        navigator.share({
            title: '{{ solution.title }}',
            text: '{{ solution.problem_description|truncatewords:20 }}',
            url: window.location.href
        });
    } else {
        // Fallback to copying URL
        navigator.clipboard.writeText(window.location.href).then(function() {
            alert('URL copied to clipboard!');
        });
    }
}

// Helpful functionality
function toggleHelpful() {
    // This would normally make an AJAX call to increment the helpful count
    // For now, just show feedback
    const button = event.target.closest('button');
    const originalText = button.innerHTML;
    
    button.innerHTML = `
        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V8a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
        </svg>
        Thanks!
    `;
    button.classList.add('bg-green-100', 'text-green-700');
    button.classList.remove('bg-gray-100', 'text-gray-700');
    
    setTimeout(() => {
        button.innerHTML = originalText;
        button.classList.remove('bg-green-100', 'text-green-700');
        button.classList.add('bg-gray-100', 'text-gray-700');
    }, 2000);
}

// CSS classes for difficulty badges
document.addEventListener('DOMContentLoaded', function() {
    // Add appropriate classes for difficulty badges in related solutions
    const difficultyBadges = document.querySelectorAll('[class*="-class"]');
    difficultyBadges.forEach(badge => {
        const classes = badge.className;
        if (classes.includes('beginner-class')) {
            badge.className = badge.className.replace('beginner-class', 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300');
        } else if (classes.includes('intermediate-class')) {
            badge.className = badge.className.replace('intermediate-class', 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300');
        } else if (classes.includes('advanced-class')) {
            badge.className = badge.className.replace('advanced-class', 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300');
        }
    });
});
</script>

{% endblock %}
